$(window).on("load",function(){var chartColors=["#e91e63","#9c27b0","#673ab7","#f44336","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4caf50","#8bc34a","#cddc39","#ffeb3b","#ffc107","#ff9800","#ff5722","#795548","#9e9e9e","#607d8b"],skipCap=5,skipIndex=5,poolData,charts={workers:void 0,hashrate:void 0,distWorkers:void 0,distHashrate:void 0},graphData={workers:[],hashrate:[],blocks:[]},getHashrateString=function(hash){for(var hashrate=hash,i=0,units=["H/s","KH/s","MH/s","GH/s","TH/s","PH/s"];hashrate>1e3;)hashrate/=1e3,i++;return null===hashrate?"0 H/s":hashrate.toFixed(2)+" "+units[i]},emaProcess=function(dataObjArray,timePeriods=12){var k=2/(timePeriods+1);dataObjArray[0].ema=dataObjArray[0].original;let emaArray=[dataObjArray[0]];for(let i=1;i<dataObjArray.length;i++){let e=dataObjArray[i].original*k;e+=emaArray[i-1].ema*(1-k),dataObjArray[i].ema=e,emaArray.push(dataObjArray[i])}return dataObjArray},getTransparentHex=function(hex,opacity){let r,g,b;return hex=hex.replace("#",""),"rgba("+parseInt(hex.substring(0,2),16)+","+parseInt(hex.substring(2,4),16)+","+parseInt(hex.substring(4,6),16)+","+opacity/100+")"},handleEntry=function(history){let time=1e3*history.time,data=history.data;return history?skipIndex<5?(skipIndex++,{workers:{x:time,y:data.workerCount},blocks:{x:time,y:data.blocks.pending}}):(skipIndex=0,{workers:{x:time,y:data.workerCount},hashrate:{x:time,y:data.hashrate,original:data.hashrate,ema:0},blocks:{x:time,y:data.blocks.pending}}):{}},buildGraphData=function(data){var store={workers:{label:"Workers",pointRadius:0,steppedLine:!0,borderColor:chartColors[0],backgroundColor:getTransparentHex(chartColors[0],20),data:[]},hashrate:{label:"Hashrate",pointRadius:1,steppedLine:!1,borderColor:chartColors[1],backgroundColor:getTransparentHex(chartColors[1],20),data:[]},blocks:{label:"Pending Blocks",pointRadius:0,steppedLine:!0,borderColor:chartColors[2],backgroundColor:getTransparentHex(chartColors[2],20),data:[]}};let analyzed=handleHistory(store,data.history);return emaProcess(analyzed.hashrate.data,24),analyzed},handleHistory=function(store,history){for(let h in poolData.history)if(Object.prototype.hasOwnProperty.call(poolData.history,h)){let entry=history[h],parsed=handleEntry(entry);for(let e in parsed)if(Object.prototype.hasOwnProperty.call(parsed,e)){let root=store[e];root&&root.data.push(parsed[e])}}return store},createLineChart=function(id,datasets,beginAtZero=!0,steps=10,stepValue=5,callback=function(value){return value}){var ctx=$(`#${id}`);return new Chart(ctx,{type:"line",data:{datasets:datasets},options:{scales:{yAxes:[{gridLines:{color:"rgba(100, 100, 100, 0.1)"},ticks:{beginAtZero:beginAtZero,steps:steps,stepValue:stepValue,callback:callback}}],xAxes:[{type:"time",distribution:"series",gridLines:{display:!1},ticks:{source:"labels",steps:10,stepValue:1}}]}}})},buildGraphs=function(data){try{charts.workers=createLineChart("pool-chart-workers",[data.workers],!0,1,2,value=>{if(0==value)return value;{let floor=Math.floor(value);return floor<=0?"":floor}}),charts.hashrate=createLineChart("pool-chart-hashrate",[data.hashrate],!0,10,5,value=>getHashrateString(value))}catch(e){throw new Error(e)}return!0};$.getJSON(`/api/pool_stats?${_pool}`,function(data){poolData=data,graphData=buildGraphData(data),buildGraphs(graphData)})});